<script type="text/javascript">
    RED.nodes.registerType('pb-list', {
        category: 'PocketBase',
        color: '#a6bbcf',
        defaults: {
            name: { value: "" },
            collection: { value: "" },
            page: { value: 1, validate: RED.validators.number() },
            perPage: { value: 50, validate: RED.validators.number() },
            filter: { value: "" },
            sort: { value: "" },
            expand: { value: "" },
            mode: { value: "page" }
        },
        inputs: 1,
        outputs: 1,
        icon: "pocketbase.svg",
        paletteLabel: 'list',
        label: function() {
            return this.name || `List ${this.collection || ''}`;
        }
    });
</script>

<script type="text/html" data-template-name="pb-list">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-collection"><i class="icon-table"></i> Collection</label>
        <input type="text" id="node-input-collection" placeholder="Collection name or leave empty for msg.collection">
    </div>
    <div class="form-row">
        <label for="node-input-page"><i class="icon-bookmark"></i> Page</label>
        <input type="number" id="node-input-page" placeholder="1" min="1">
    </div>
    <div class="form-row">
        <label for="node-input-perPage"><i class="icon-list"></i> Per Page</label>
        <input type="number" id="node-input-perPage" placeholder="50" min="1" max="99999">
    </div>
    <div class="form-row">
        <label for="node-input-filter"><i class="icon-filter"></i> Filter</label>
        <input type="text" id="node-input-filter" placeholder="status = 'active' AND created > '2023-01-01'">
    </div>
    <div class="form-row">
        <label for="node-input-sort"><i class="icon-sort"></i> Sort</label>
        <input type="text" id="node-input-sort" placeholder="-created,+name">
    </div>
    <div class="form-row">
        <label for="node-input-expand"><i class="icon-share"></i> Expand</label>
        <input type="text" id="node-input-expand" placeholder="user,category">
    </div>
    <div class="form-row">
        <label for="node-input-mode"><i class="icon-flow-branch"></i> Output Mode</label>
        <select id="node-input-mode" style="width:70%">
            <option value="page">Page (complete result object)</option>
            <option value="items">Items (array of records only)</option>
            <option value="split">Split (one message per record)</option>
            <option value="first">First (first matching record only)</option>
        </select>
    </div>
</script>

<script type="text/html" data-help-name="pb-list">
    <p>Retrieve paginated list of records from a PocketBase collection.</p>
    
    <h3>Configuration</h3>
    <ul>
        <li><strong>Collection:</strong> PocketBase collection name (can be overridden by msg.collection)</li>
        <li><strong>Page:</strong> Default page number (can be overridden by msg.page)</li>
        <li><strong>Per Page:</strong> Default records per page (can be overridden by msg.perPage)</li>
        <li><strong>Filter:</strong> Default filter expression (can be overridden by msg.filter)</li>
        <li><strong>Sort:</strong> Default sort expression (can be overridden by msg.sort)</li>
        <li><strong>Expand:</strong> Default relation fields to expand (can be overridden by msg.expand)</li>
        <li><strong>Output Mode:</strong> How to send the results:
            <ul>
                <li><em>Page:</em> Complete result object with items, page info, etc.</li>
                <li><em>Items:</em> Only the array of records</li>
                <li><em>Split:</em> Each record sent as a separate message</li>
                <li><em>First:</em> Only the first matching record (ignores page/perPage)</li>
            </ul>
        </li>
    </ul>

    <h3>Input Properties</h3>
    <dl class="message-properties">
        <dt>collection <span class="property-type">string</span></dt>
        <dd>Collection name (overrides node config)</dd>
        <dt>page <span class="property-type">number</span></dt>
        <dd>Page number to retrieve (default: 1)</dd>
        <dt>perPage <span class="property-type">number</span></dt>
        <dd>Records per page (default: 50, max: 500)</dd>
        <dt>filter <span class="property-type">string</span></dt>
        <dd>Filter expression (PocketBase syntax)</dd>
        <dt>sort <span class="property-type">string</span></dt>
        <dd>Sort expression (e.g., "-created,+name")</dd>
        <dt>expand <span class="property-type">string</span></dt>
        <dd>Relation fields to expand</dd>
        <dt>mode <span class="property-type">string</span></dt>
        <dd>Output mode: "page", "items", "split", or "first"</dd>
    </dl>

    <h3>Outputs</h3>
    <dl class="message-properties">
        <dt>payload <span class="property-type">object|array|object|null</span></dt>
        <dd>Depends on mode:
            <ul>
                <li><em>page:</em> Complete result object with items, page, perPage, totalItems, totalPages</li>
                <li><em>items:</em> Array of records only</li>
                <li><em>split:</em> Individual record object (one message per record)</li>
                <li><em>first:</em> First matching record object, or null if no match</li>
            </ul>
        </dd>
        <dt>pb <span class="property-type">PocketBase</span></dt>
        <dd>Authenticated PocketBase client for chaining</dd>
    </dl>

    <h3>Examples</h3>
    <p><strong>Filter:</strong> <code>status = 'active' AND created > '2023-01-01'</code></p>
    <p><strong>Sort:</strong> <code>-created,+name</code> (descending created, ascending name)</p>
</script>